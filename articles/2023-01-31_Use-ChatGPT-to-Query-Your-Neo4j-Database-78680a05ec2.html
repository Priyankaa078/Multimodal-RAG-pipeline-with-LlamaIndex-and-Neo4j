<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Use ChatGPT to Query Your Neo4j Database</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Use ChatGPT to Query Your Neo4j Database</h1>
</header>
<section data-field="subtitle" class="p-summary">
An easy approach to let ChatGPT to learn your graph schema and help you construct Cypher queries
</section>
<section data-field="body" class="e-content">
<section name="257a" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="19ae" id="19ae" class="graf graf--h3 graf--leading graf--title">Use ChatGPT to Query Your Neo4j Database</h3><h4 name="4570" id="4570" class="graf graf--h4 graf-after--h3 graf--subtitle">An easy approach to let ChatGPT to learn your graph schema and help you construct Cypher queries</h4><p name="d083" id="d083" class="graf graf--p graf-after--h4">ChatGPT has taken the world by storm. It is virtually impossible to not be bombarded with various information about it. I guess it is only a matter of time before a plethora of AI-generated content hits the internet.</p><p name="4ed4" id="4ed4" class="graf graf--p graf-after--p">I have been playing around with ChatGPT and trying to produce Cypher queries in my free time. I came across a <a href="https://neo4j.com/developer-blog/create-neo4j-database-model-with-chatgpt/" data-href="https://neo4j.com/developer-blog/create-neo4j-database-model-with-chatgpt/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">blog post using ChatGPT to help model a graph and create some basic queries in Neo4j</a>. Consequently, I decided to write up my experience using ChatGPT as a question2cypher or english2cypher engine.</p><h4 name="7e15" id="7e15" class="graf graf--h4 graf-after--p">Neo4j Aura setup</h4><p name="da85" id="da85" class="graf graf--p graf-after--h4">We will use <a href="https://neo4j.com/cloud/platform/aura-graph-database/" data-href="https://neo4j.com/cloud/platform/aura-graph-database/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Neo4j Aura</a>, which offers a free cloud instance of the Neo4j database with pre-populated data, for this experiment. Once you have logged in, click on the <strong class="markup--strong markup--p-strong">New Instance</strong> and select the <strong class="markup--strong markup--p-strong">Graph based Recommendations</strong> dataset.</p><figure name="6791" id="6791" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*ia2U1iez2tIdOg5M3bWz-w.png" data-width="1288" data-height="584" src="https://cdn-images-1.medium.com/max/800/1*ia2U1iez2tIdOg5M3bWz-w.png"><figcaption class="imageCaption">Select Graph Based Recommendations dataset. Image by the author.</figcaption></figure><p name="5bb5" id="5bb5" class="graf graf--p graf-after--figure">After the database instance has been started, click on the <strong class="markup--strong markup--p-strong">Query</strong> button to open Neo4j Browser.</p><h4 name="db8a" id="db8a" class="graf graf--h4 graf-after--p">ChatGPT Setup</h4><p name="f8d0" id="f8d0" class="graf graf--p graf-after--h4">Next, you will need to set up ChatGPT if you haven’t already done so. Open the <a href="https://chat.openai.com/" data-href="https://chat.openai.com/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">ChatGPT website</a> and follow the registration instructions. After completion, you should have the ChatGPT user interface in front of you.</p><figure name="fcbc" id="fcbc" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*LcgtkmTM_m4h6Go5JgoeRg.png" data-width="821" data-height="747" src="https://cdn-images-1.medium.com/max/800/1*LcgtkmTM_m4h6Go5JgoeRg.png"><figcaption class="imageCaption">ChatGPT user interface. Image by the author.</figcaption></figure><h4 name="80eb" id="80eb" class="graf graf--h4 graf-after--figure">Define graph schema</h4><p name="054b" id="054b" class="graf graf--p graf-after--h4">ChatGPT has some experience with using Cypher and the property graph model. It does, however, doesn’t know the schema of your graph. Therefore, to avoid ChatGPT from guessing and hallucinating node labels and properties of your graph, it is essential to feed it with the information.</p><p name="0c3a" id="0c3a" class="graf graf--p graf-after--p">I think that the best way to inform the ChatGPT about the node labels and relationship types is to use the following APOC procedure.</p><pre data-code-block-mode="1" spellcheck="false" data-code-block-lang="vbnet" name="9d0a" id="9d0a" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">CALL</span> apoc.meta.stats<br /><span class="hljs-keyword">YIELD</span> labels, relTypes</span></pre><p name="f6c7" id="f6c7" class="graf graf--p graf-after--pre"><em class="markup--em markup--p-em">Results</em></p><figure name="fd31" id="fd31" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*9m28Tzpa3f64ojAM2mAYTQ.png" data-width="1293" data-height="344" src="https://cdn-images-1.medium.com/max/800/1*9m28Tzpa3f64ojAM2mAYTQ.png"><figcaption class="imageCaption">Apoc schema results. Image by the author.</figcaption></figure><p name="4020" id="4020" class="graf graf--p graf-after--figure">Suppose you run the above APOC schema procedure in Neo4j Browser. In that case, you can simply copy the text version of the response and paste it into ChatGPT with additional information that this is the schema definition for a Neo4j database.</p><blockquote name="9670" id="9670" class="graf graf--blockquote graf-after--p">I have a Neo4j database with the following schema:<br> —Results of APOC schema procedure—</blockquote><figure name="919c" id="919c" class="graf graf--figure graf-after--blockquote"><img class="graf-image" data-image-id="1*0GhsP4hRGbTGAm_snM6baQ.png" data-width="725" data-height="212" src="https://cdn-images-1.medium.com/max/800/1*0GhsP4hRGbTGAm_snM6baQ.png"><figcaption class="imageCaption">Image by the author.</figcaption></figure><p name="2398" id="2398" class="graf graf--p graf-after--figure">I got the following response, but the reactions may vary significantly between different executions. Next, you need to give it information about node and relationship properties since that is not available in the APOC schema procedure. We can use the following Cypher query to extract all property keys by their node and relationship type</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="sql" name="2163" id="2163" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content"><span class="hljs-keyword">MATCH</span> (n)<br />UNWIND keys(n) <span class="hljs-keyword">AS</span> key<br /><span class="hljs-keyword">RETURN</span> labels(n)[<span class="hljs-number">0</span>] <span class="hljs-keyword">AS</span> label, <span class="hljs-keyword">collect</span>(<span class="hljs-keyword">distinct</span> key) <span class="hljs-keyword">AS</span> propertyKeys<br /><span class="hljs-keyword">UNION</span><br /><span class="hljs-keyword">MATCH</span> ()<span class="hljs-operator">-</span>[r]<span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span>()<br />UNWIND keys(r) <span class="hljs-keyword">AS</span> key<br /><span class="hljs-keyword">RETURN</span> type(r) <span class="hljs-keyword">AS</span> label, <span class="hljs-keyword">collect</span>(<span class="hljs-keyword">distinct</span> key) <span class="hljs-keyword">AS</span> propertyKeys</span></pre><p name="39f7" id="39f7" class="graf graf--p graf-after--pre">You can feed this information into ChatGPT by informing it that you are providing information about node and relationship types.</p><figure name="a9e7" id="a9e7" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*0_Jr_tBr5Ya3LUAFVuEuXw.png" data-width="919" data-height="678" src="https://cdn-images-1.medium.com/max/800/1*0_Jr_tBr5Ya3LUAFVuEuXw.png"><figcaption class="imageCaption">Providing node and relationship property keys. Image by the author.</figcaption></figure><h4 name="b99a" id="b99a" class="graf graf--h4 graf-after--figure">Generating Cypher queries with ChatGPT</h4><p name="1f60" id="1f60" class="graf graf--p graf-after--h4">Now we can go ahead and test how well does ChatGPT generate Cypher queries based on various prompts. We need to inform ChatGPT that it will be producing Cypher queries. What I found is needed to provide in the initial prompt is that it should not make any assumptions about queries from previous prompts as otherwise it tries to combine information from previous unrelated prompts into newly generated Cypher queries. You can also omit query explanations if you so wish.</p><blockquote name="1b9c" id="1b9c" class="graf graf--blockquote graf-after--p">Now you will generate Cypher queries based on prompts. Do not post any explanations unless explicitly specified. Also do not make any assumptions about the context. Only look at the context of the given prompt and do not assume anything else from previous prompts.</blockquote><p name="2bb2" id="2bb2" class="graf graf--p graf-after--blockquote"><em class="markup--em markup--p-em">I’ve asked it explicitly to not assume anything on previous prompts as, at first, it assumed my movie preferences as I was asking about Keanu Reeves and comedies a lot. The generated queries seem mostly the same if you ask it to forget or not. The only difference is when I asked for recommendations, it assumed I liked Keanu Reeves and comedies, so it went with that. Additionally, graph schema forgetting also happens in both cases, whether you ask it to forget previous prompts or not.</em></p><p name="da2a" id="da2a" class="graf graf--p graf-after--p">We can start with something simple.</p><figure name="b23b" id="b23b" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*HeK_P56TlBpLjC_xselyFA.png" data-width="802" data-height="260" src="https://cdn-images-1.medium.com/max/800/1*HeK_P56TlBpLjC_xselyFA.png"><figcaption class="imageCaption">Image by the author.</figcaption></figure><p name="2d79" id="2d79" class="graf graf--p graf-after--figure">The provided query works as intended. We can try something more complex now.</p><figure name="b220" id="b220" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*qnbpuYa6VjjEFv0lguqa_A.png" data-width="816" data-height="270" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/1*qnbpuYa6VjjEFv0lguqa_A.png"><figcaption class="imageCaption">Image by the author.</figcaption></figure><p name="74a4" id="74a4" class="graf graf--p graf-after--figure">Again, the query works as it should. ChatGPT is quite good at basic graph-pattern matching and aggregations. It also picks the correct node properties most of the time. However, it has problems with so-called existential queries that could return either true if the pattern exists or false if the pattern is not matched.</p><figure name="aa1a" id="aa1a" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*Q6xEpGG6i70vlwgS_qHXtQ.png" data-width="722" data-height="385" src="https://cdn-images-1.medium.com/max/800/1*Q6xEpGG6i70vlwgS_qHXtQ.png"><figcaption class="imageCaption">Image by the author.</figcaption></figure><p name="7de0" id="7de0" class="graf graf--p graf-after--figure">It seems that it prefers the <code class="markup--code markup--p-code">MATCH</code> clause and has not mastered <code class="markup--code markup--p-code">OPTIONAL MATCH</code> or other approaches that allow null values. However with some help, it manages to get the job done.</p><figure name="4852" id="4852" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*HCY9Sz3Rxv4ROGJIepaRiA.png" data-width="720" data-height="187" src="https://cdn-images-1.medium.com/max/800/1*HCY9Sz3Rxv4ROGJIepaRiA.png"><figcaption class="imageCaption">Image by the author.</figcaption></figure><p name="3464" id="3464" class="graf graf--p graf-after--figure">The only problem is that it forgot about Keanu Reeves.<br>So it is only checking if an actor appeared in the Matrix.</p><figure name="57ed" id="57ed" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*TnxeUQt0oWzhpWnNgMyjPw.png" data-width="660" data-height="181" src="https://cdn-images-1.medium.com/max/800/1*TnxeUQt0oWzhpWnNgMyjPw.png"><figcaption class="imageCaption">Image by the author.</figcaption></figure><p name="b3fd" id="b3fd" class="graf graf--p graf-after--figure">Feels like rubber duck programming with someone with a lot of creativity but little to no attention since the query again forgot about <code class="markup--code markup--p-code">OPTIONAL MATCH</code>. Maybe ChatGPT just has incurable ADHD. It definitely needs some fine-tuning if you want it to generate queries that allow null or 0 values.</p><p name="811b" id="811b" class="graf graf--p graf-after--p">Next, we can check how creative ChatGPT is. We can ask it to find the most popular comedies without specifying what popular means.</p><figure name="2183" id="2183" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*lVxztDNWMEojIA9bH-iZkw.png" data-width="706" data-height="273" src="https://cdn-images-1.medium.com/max/800/1*lVxztDNWMEojIA9bH-iZkw.png"><figcaption class="imageCaption">Image by the author.</figcaption></figure><p name="b66e" id="b66e" class="graf graf--p graf-after--figure">The generated query is outstanding. There are probably a lot of movie recommendation tutorials that ChatGPT can learn from. Additionally, it correctly assumed that <strong class="markup--strong markup--p-strong">the imdbRating</strong> property holds some sort of popularity rating value.</p><p name="1b3f" id="1b3f" class="graf graf--p graf-after--p">We can ask it to include ratings from users in the database.</p><figure name="3729" id="3729" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*HIVOtIVHff4hEutznYjZ9w.png" data-width="721" data-height="305" src="https://cdn-images-1.medium.com/max/800/1*HIVOtIVHff4hEutznYjZ9w.png"><figcaption class="imageCaption">Image by the author.</figcaption></figure><p name="dc4b" id="dc4b" class="graf graf--p graf-after--figure">At first, I was impressed. Even though it did not combine IMDB ratings and user ratings, it provided a good start for user ratings. However, it forgot that genres are a separate node, not a node property.</p><figure name="f729" id="f729" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*r0QmJx8RIlo-VvMK90er1Q.png" data-width="656" data-height="616" src="https://cdn-images-1.medium.com/max/800/1*r0QmJx8RIlo-VvMK90er1Q.png"><figcaption class="imageCaption">Image by the author.</figcaption></figure><p name="dcb7" id="dcb7" class="graf graf--p graf-after--figure">While the corrected Cypher query now correctly identifies genres as separate nodes, for some reason, it decided that the popularity should now be defined as the number of IMDB votes. Therefore, even if you get a generated Cypher query that works well, there is no guarantee that you will get the same Cypher statement next time, even though it claims that consistency is important.</p><p name="6f81" id="6f81" class="graf graf--p graf-after--p">Let’s try another prompt where some Cypher creativity is appreciated.</p><figure name="1c01" id="1c01" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*sggbJxPYS8xjuhKSFrZEIg.png" data-width="711" data-height="434" src="https://cdn-images-1.medium.com/max/800/1*sggbJxPYS8xjuhKSFrZEIg.png"><figcaption class="imageCaption">Image by the author.</figcaption></figure><p name="c53b" id="c53b" class="graf graf--p graf-after--figure">Even though it complains that it cannot provide good recommendations, it still offers a good starting point. Let’s see if we can try to improve the recommendations.</p><figure name="a5bc" id="a5bc" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*i9HWyewgHQj6ehDyrR1J9A.png" data-width="643" data-height="353" src="https://cdn-images-1.medium.com/max/800/1*i9HWyewgHQj6ehDyrR1J9A.png"><figcaption class="imageCaption">Image by the author.</figcaption></figure><p name="b0c5" id="b0c5" class="graf graf--p graf-after--figure">It seems that ChatGPT has some ideas about using average movie ratings of co-actors and then providing actors that co-starred with Keanu Reeves in movies with the highest rating as recommendations.</p><p name="768c" id="768c" class="graf graf--p graf-after--p">The only problem is that the above query doesn’t work. Again, the ChatGPT hallucinated node property <strong class="markup--strong markup--p-strong">imdb_rating</strong> instead of <strong class="markup--strong markup--p-strong">imdbRating</strong>. Additionally, it collects movie ratings in the fourth row and then tries to average them. Unfortunately, Cypher does not allow averaging arrays with <code class="markup--code markup--p-code">avg()</code> operator. So we would either need to remove <code class="markup--code markup--p-code">collect</code> or use APOC.</p><figure name="6120" id="6120" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*YJmeq3775eZCc1M7MCnczQ.png" data-width="633" data-height="329" src="https://cdn-images-1.medium.com/max/800/1*YJmeq3775eZCc1M7MCnczQ.png"><figcaption class="imageCaption">Image by the author.</figcaption></figure><p name="8d3e" id="8d3e" class="graf graf--p graf-after--figure">Now, the ADHD in ChatGPT decided we should go with the same basic recommendation as it started. However, if you are using Neo4j v5, there is another problem. <a href="https://towardsdatascience.com/how-cypher-changed-in-neo4j-v5-d0f10cbb60bf" data-href="https://towardsdatascience.com/how-cypher-changed-in-neo4j-v5-d0f10cbb60bf" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Several Cypher syntaxes have been deprecated in v5</a>, and Chat GPT is unaware of that and needs to be trained with the latest Cypher syntax. In the above example, the <code class="markup--code markup--p-code">size()</code> operator can no longer be used count graph patterns in Neo4j v5.</p><p name="9800" id="9800" class="graf graf--p graf-after--p">Lastly, I wanted to try if ChatGPT is a graph data scientist.</p><figure name="1c27" id="1c27" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*_wHBKSo-mCIEZDfYzy4r9g.png" data-width="643" data-height="473" src="https://cdn-images-1.medium.com/max/800/1*_wHBKSo-mCIEZDfYzy4r9g.png"><figcaption class="imageCaption">Image by the author.</figcaption></figure><p name="b64c" id="b64c" class="graf graf--p graf-after--figure">By default, ChatGPT wants to use the deprecated Graph Algorithms library. Correcting it to use the Graph Data Science library improves the query a bit, but not entirely. The GDS library does not support anonymous graphs since the 2.0 version. Therefore, you need to project an in-memory graph separately and then run PageRank on top of that.</p><figure name="233c" id="233c" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*4ji6uZQAsAZjDQ7Tfk-2rw.png" data-width="660" data-height="342" src="https://cdn-images-1.medium.com/max/800/1*4ji6uZQAsAZjDQ7Tfk-2rw.png"><figcaption class="imageCaption">Image by the author.</figcaption></figure><p name="018f" id="018f" class="graf graf--p graf-after--figure">It’s good some good ideas, but again the syntax will not work. However, it can be used as a good starting point.</p><h4 name="e851" id="e851" class="graf graf--h4 graf-after--p">Conclusion</h4><p name="4551" id="4551" class="graf graf--p graf-after--h4">ChatGPT shows great potential to be used as an interface to query Neo4j database. It works well with basic graph matching and aggregations. Unfortunately, it sometimes forget exact property names or graph schema, but with a little help it remembers them.</p><p name="3f4b" id="3f4b" class="graf graf--p graf-after--p">However, when you want to generate complex queries, it is as likely that the query will be valid or invalid. Debugging complex queries feels like rubber duck programming with an ADHD person with a short attention span. While it might solve bugs you explicitly mention, it might change other variables or introduce new bugs. Consistency is not the best part of ChatGPT. Additionally, it wasn’t trained on the newer Cypher syntax used in Neo4j v5 or the Graph Data Science library. Therefore, it would require additional fine-tuning to get it right.</p><p name="f23e" id="f23e" class="graf graf--p graf-after--p">Overall, I feel like ChatGPT, in its current state, can be used to generate simple queries and schema. For more complex tasks like providing recommendations, it can be used to hint at Cypher syntax or how to approach solving the problem, but it definitely shouldn’t be relied on to offer valid queries. I am excited to see how newer versions of ChatGPT trained on more recent data will perform. I might also try to fine-tune ChatGPT or GPT-3 and see how it works.</p><p name="fa5a" id="fa5a" class="graf graf--p graf-after--p graf--trailing"><em class="markup--em markup--p-em">p.s. Article by </em><a href="https://medium.com/u/ff9d63e09a67" data-href="https://medium.com/u/ff9d63e09a67" data-anchor-type="2" data-user-id="ff9d63e09a67" data-action-value="ff9d63e09a67" data-action="show-user-card" data-action-type="hover" class="markup--user markup--p-user" target="_blank"><em class="markup--em markup--p-em">Sixing Huang</em></a><em class="markup--em markup--p-em"> about </em><a href="https://towardsdatascience.com/gpt-3-for-doctor-ai-1396d1cd6fa5" data-href="https://towardsdatascience.com/gpt-3-for-doctor-ai-1396d1cd6fa5" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank"><em class="markup--em markup--p-em">using GPT-3 to generate Cypher query</em></a><em class="markup--em markup--p-em">.</em></p></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@bratanic-tomaz" class="p-author h-card">Tomaz Bratanic</a> on <a href="https://medium.com/p/78680a05ec2"><time class="dt-published" datetime="2023-01-31T14:05:53.388Z">January 31, 2023</time></a>.</p><p><a href="https://medium.com/@bratanic-tomaz/use-chatgpt-to-query-your-neo4j-database-78680a05ec2" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on November 5, 2023.</p></footer></article></body></html>